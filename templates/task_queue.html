{% extends "base.html" %}
{% block title %}查看任务队列{% endblock %}
{% block scripts %}
    <script type="text/javascript">
        $("#task_queue").addClass("active");
        $.get("/refresh_queue/");
        setInterval("refresh()", 10000);
        function refresh(){
            history.go(0);
        }
    </script>
{% endblock %}
{% block content %}
    <div class="container-fluid offset4">
        <div class="well well-small text-center">
                <h3>查看任务队列</h3>
        </div>
        <div class="container-fluid">
            {% if tasks %}
            <table class="table table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th> 任务ID </th>
                        <th> 服务名 </th>
                        <th> 任务内容 </th>
                        <th> 状态 </th>
                        <th> 结果 </th>
                        <th> 执行人 </th>
                        <th> 更新时间 </th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in tasks %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>{{ item.t_service }}</td>
                        <td>{{ item.t_content }}</td>
                        {% if item.t_status == "SUCCESS" %}
                            <td><span class="label label-success">{{ item.t_status }}</span></td>
                        {% else %}
                            {% if item.t_status == "FAILURE" %}
                                <td><span class="label label-important">{{ item.t_status }}</span></td>
                            {% else %}
                                <td><span class="label label-info">{{ item.t_status }}</span></td>
                            {% endif %}
                        {% endif %}
                        <td>{{ item.t_result }}</td>
                        <td>{{ item.t_people }}</td>
                        <td>{{ item.t_time|date:"Y-m-d H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <h3>暂无任务信息</h3>
            {% endif %}
    	</div>
        <div >
            <ul class="pager">
                {% if page_obj.has_previous %}
                    <li><a href="/task_queue/?page={{ page_obj.previous_page_number }}">上一页</a></li>
                {% else %}
                    <li class="disabled"><a href="javascript:void(0)">上一页</a></li>
                {% endif %}
                    <li>第 {{ page_obj.number }} 页，共 {{ page_obj.paginator.num_pages }}页</li>
                {% if page_obj.has_next %}
                    <li><a href="/task_queue/?page={{ page_obj.next_page_number }}">下一页</a></li>
                {% else %}
                    <li class="disabled"><a href="javascript:void(0)">下一页</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
{% endblock %}